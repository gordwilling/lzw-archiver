<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Archiver Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="button_large_logo.png"/></td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.2 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('class_archiver.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="class_archiver-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">Archiver Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="_archiver_8h_source.html">Archiver.h</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a37b60bf73ea53d895ad54d8bb4c08e01"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_archiver.html#a37b60bf73ea53d895ad54d8bb4c08e01">Archiver</a> ()</td></tr>
<tr class="separator:a37b60bf73ea53d895ad54d8bb4c08e01"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a444f4f2179d485251924fdae593a88b9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_archiver.html#a444f4f2179d485251924fdae593a88b9">New</a> (const std::string &amp;archivePath)</td></tr>
<tr class="separator:a444f4f2179d485251924fdae593a88b9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad68c450b1181d62fc3ff62e1dbbaaf20"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_archiver.html#ad68c450b1181d62fc3ff62e1dbbaaf20">AddFile</a> (const std::string &amp;filePath, const std::string &amp;fileName)</td></tr>
<tr class="separator:ad68c450b1181d62fc3ff62e1dbbaaf20"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab1593f11dac0f5e4f7092de25a9005ae"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_archiver.html#ab1593f11dac0f5e4f7092de25a9005ae">Save</a> ()</td></tr>
<tr class="separator:ab1593f11dac0f5e4f7092de25a9005ae"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a06897312c155d91a5130f49cd00be491"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_archiver.html#a06897312c155d91a5130f49cd00be491">Extract</a> (const std::string &amp;targetDirectory)</td></tr>
<tr class="separator:a06897312c155d91a5130f49cd00be491"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af90e21f2e82b438da7a06d85873b6910"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_archiver.html#af90e21f2e82b438da7a06d85873b6910">Load</a> (const std::string &amp;archivePath)</td></tr>
<tr class="separator:af90e21f2e82b438da7a06d85873b6910"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aec8bca30ca65be7e2aaee185c33072cf"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_archiver.html#aec8bca30ca65be7e2aaee185c33072cf">FileExists</a> (const std::string &amp;filePath)</td></tr>
<tr class="separator:aec8bca30ca65be7e2aaee185c33072cf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa1b1f55fb19f6be1ed2deacbe6badaf7"><td class="memItemLeft" align="right" valign="top">unsigned long long&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_archiver.html#aa1b1f55fb19f6be1ed2deacbe6badaf7">FileSize</a> (const std::string &amp;filePath)</td></tr>
<tr class="separator:aa1b1f55fb19f6be1ed2deacbe6badaf7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad10ce9510f82df224ce604e470cf2ca4"><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_archive_descriptor.html">ArchiveDescriptor</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_archiver.html#ad10ce9510f82df224ce604e470cf2ca4">descriptor</a> ()</td></tr>
<tr class="separator:ad10ce9510f82df224ce604e470cf2ca4"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr class="memitem:a5d78f57a4e1035fd5bb380eee8cfc8bf"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_archiver.html#a5d78f57a4e1035fd5bb380eee8cfc8bf">PositionStreamAtFooter</a> (std::istream &amp;archiveStream)</td></tr>
<tr class="separator:a5d78f57a4e1035fd5bb380eee8cfc8bf"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:af2fb4aea2e55ed35f61f2ef01b2a8076"><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_archive_descriptor.html">ArchiveDescriptor</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_archiver.html#af2fb4aea2e55ed35f61f2ef01b2a8076">m_descriptor</a></td></tr>
<tr class="separator:af2fb4aea2e55ed35f61f2ef01b2a8076"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This class handles the file archiving tasks, including creation, loading, and extraction of archives </p>

<p>Definition at line <a class="el" href="_archiver_8h_source.html#l00015">15</a> of file <a class="el" href="_archiver_8h_source.html">Archiver.h</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a37b60bf73ea53d895ad54d8bb4c08e01"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">Archiver::Archiver </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Default constructor </p>

<p>Definition at line <a class="el" href="_archiver_8h_source.html#l00021">21</a> of file <a class="el" href="_archiver_8h_source.html">Archiver.h</a>.</p>
<div class="fragment"><div class="line">        : <a class="code" href="class_archiver.html#af2fb4aea2e55ed35f61f2ef01b2a8076">m_descriptor</a>() </div>
<div class="line">    {</div>
<div class="line">    }</div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="ad68c450b1181d62fc3ff62e1dbbaaf20"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Archiver::AddFile </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>filePath</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>fileName</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Adds a file to the currently referenced <a class="el" href="class_archive_descriptor.html">ArchiveDescriptor</a> </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">filePath</td><td>the fully qualified path of the file </td></tr>
    <tr><td class="paramname">fileName</td><td>the fileName itself (name &amp; extension) without path information </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="_archiver_8cpp_source.html#l00018">18</a> of file <a class="el" href="_archiver_8cpp_source.html">Archiver.cpp</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span>( <a class="code" href="class_archiver.html#aec8bca30ca65be7e2aaee185c33072cf">FileExists</a>( filePath ) )</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="class_archiver.html#ad10ce9510f82df224ce604e470cf2ca4">descriptor</a>().<a class="code" href="class_archive_descriptor.html#a5bb6959e9022cf36b08b54cf31e6d4ed">entries</a>().push_back( <a class="code" href="class_archive_entry.html">ArchiveEntry</a>( filePath, fileName ) );</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> </div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">throw</span> <a class="code" href="class_archiver_exception.html">ArchiverException</a>( <span class="stringliteral">&quot;Could not add the file to the archive because the file does not exist.&quot;</span> );</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ad10ce9510f82df224ce604e470cf2ca4"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_archive_descriptor.html">ArchiveDescriptor</a>&amp; Archiver::descriptor </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<dl class="section return"><dt>Returns</dt><dd>a reference to the descriptor of the currently loaded archive </dd></dl>

<p>Definition at line <a class="el" href="_archiver_8h_source.html#l00074">74</a> of file <a class="el" href="_archiver_8h_source.html">Archiver.h</a>.</p>
<div class="fragment"><div class="line">{ <span class="keywordflow">return</span> <a class="code" href="class_archiver.html#af2fb4aea2e55ed35f61f2ef01b2a8076">m_descriptor</a>; }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a06897312c155d91a5130f49cd00be491"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Archiver::Extract </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>targetDirectory</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Extracts the files in the currently loaded archive to the specified target directory </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">targetDirectory</td><td>the directory into which the files are to be placed</td></tr>
  </table>
  </dd>
</dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000002">Todo:</a></b></dt><dd><p class="startdd">Add callback parameter to decouple progress dialog </p>
<p class="enddd">Ensure any changes made to <a class="el" href="class_archiver.html#ab1593f11dac0f5e4f7092de25a9005ae">Save()</a> are reflected here as well </p>
</dd></dl>

<p>Definition at line <a class="el" href="_archiver_8cpp_source.html#l00105">105</a> of file <a class="el" href="_archiver_8cpp_source.html">Archiver.cpp</a>.</p>
<div class="fragment"><div class="line">{   </div>
<div class="line">    std::string s;</div>
<div class="line">    std::ifstream archive( <a class="code" href="class_archiver.html#ad10ce9510f82df224ce604e470cf2ca4">descriptor</a>().filePath(), std::ios::binary | std::ios::in );</div>
<div class="line"></div>
<div class="line">    <a class="code" href="class_button.html">Button</a> b;</div>
<div class="line">    <a class="code" href="class_un_button_input_stream.html">UnButtonInputStream</a> ubstream( archive );</div>
<div class="line"></div>
<div class="line">    <a class="code" href="class_archive_entry.html#a90c10b0aa1c75f3abd539d2e089c18e6">ArchiveEntry::Vector</a> entries = <a class="code" href="class_archiver.html#ad10ce9510f82df224ce604e470cf2ca4">descriptor</a>().<a class="code" href="class_archive_descriptor.html#a5bb6959e9022cf36b08b54cf31e6d4ed">entries</a>();</div>
<div class="line">    <span class="keywordtype">int</span> fileProcessingIndex = 0;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// progress dialog... </span></div>
<div class="line">    wxProgressDialog progressDialog( <span class="stringliteral">&quot;UnButtoning&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, entries.size(), wxGetApp().GetTopWindow(), </div>
<div class="line">                wxPD_APP_MODAL | wxPD_SMOOTH | wxPD_AUTO_HIDE );</div>
<div class="line">    <span class="keywordflow">for</span>( ArchiveEntry::Vector::iterator it = entries.begin(); it != entries.end(); it++ )</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// this part is just updating progress dialog</span></div>
<div class="line">        std::ostringstream message( std::ios::out );</div>
<div class="line">        message &lt;&lt; <span class="stringliteral">&quot;UnButtoning file &quot;</span> &lt;&lt; fileProcessingIndex &lt;&lt; <span class="stringliteral">&quot; of &quot;</span> &lt;&lt; entries.size() &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; it-&gt;fileName();</div>
<div class="line">        progressDialog.Update( ++fileProcessingIndex, message.str() );</div>
<div class="line"></div>
<div class="line">        std::string outputFileName = targetDirectory + <span class="stringliteral">&quot;\\&quot;</span> + it-&gt;fileName();</div>
<div class="line">        std::ofstream outputFile( outputFileName, std::ios::binary|std::ios::out|std::ios::trunc);                  </div>
<div class="line">        </div>
<div class="line">        b.<a class="code" href="class_button.html#a0206ddf1c9144f8e8af11b39f1ea1729">decompress</a>( ubstream, outputFile );</div>
<div class="line">        outputFile.close();</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// the rest of the file is the footer, which we don&#39;t need right now</span></div>
<div class="line">    archive.close();    </div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aec8bca30ca65be7e2aaee185c33072cf"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool Archiver::FileExists </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>filePath</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">filePath</td><td>The fully qualified path to the file </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true if the file at the supplied path exists, false otherwise </dd></dl>

<p>Definition at line <a class="el" href="_archiver_8cpp_source.html#l00202">202</a> of file <a class="el" href="_archiver_8cpp_source.html">Archiver.cpp</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    DWORD dwAttrib = GetFileAttributes(filePath.c_str());</div>
<div class="line">    <span class="keywordflow">return</span> dwAttrib != INVALID_FILE_ATTRIBUTES &amp;&amp; !(dwAttrib &amp; FILE_ATTRIBUTE_DIRECTORY);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aa1b1f55fb19f6be1ed2deacbe6badaf7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned long long Archiver::FileSize </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>filePath</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">filePath</td><td>The fully qualified path to the file </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>the file size of the file at the specified path </dd></dl>

<p>Definition at line <a class="el" href="_archiver_8cpp_source.html#l00208">208</a> of file <a class="el" href="_archiver_8cpp_source.html">Archiver.cpp</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    std::ifstream is ( filePath );</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> begin = is.tellg();  </div>
<div class="line">    is.seekg ( 0, std::ios::end );</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> end  = is.tellg();</div>
<div class="line">    is.close();</div>
<div class="line">    <span class="keywordflow">return</span> end - begin;</div>
<div class="line">}</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="af90e21f2e82b438da7a06d85873b6910"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Archiver::Load </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>archivePath</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Loads the archive at the specified path. </p>

<p>Definition at line <a class="el" href="_archiver_8cpp_source.html#l00137">137</a> of file <a class="el" href="_archiver_8cpp_source.html">Archiver.cpp</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    std::ifstream archive( archivePath, std::ios::binary | std::ios::in );</div>
<div class="line">    <span class="keywordflow">if</span> ( !archive.bad() )</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="class_archive_descriptor.html">ArchiveDescriptor</a> d( archivePath );</div>
<div class="line">        </div>
<div class="line">        <a class="code" href="class_archiver.html#a5d78f57a4e1035fd5bb380eee8cfc8bf">PositionStreamAtFooter</a>( archive );</div>
<div class="line"></div>
<div class="line">        <span class="comment">// first item in footer is the number of files in the archive</span></div>
<div class="line">        archive &gt;&gt; d.fileCount();</div>
<div class="line"></div>
<div class="line">        <span class="comment">// every file has a collection of associated data</span></div>
<div class="line">        <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; d.fileCount(); i++ )</div>
<div class="line">        {   </div>
<div class="line">            d.entries().push_back( <a class="code" href="class_archive_entry.html">ArchiveEntry</a>() );</div>
<div class="line">        </div>
<div class="line">            <span class="comment">// for some reason it takes two reads to get to the filepath</span></div>
<div class="line">            std::getline( archive, d.entries()[i].filePath() );</div>
<div class="line">            std::getline( archive, d.entries()[i].filePath() );     </div>
<div class="line">            std::getline( archive, d.entries()[i].fileName() );</div>
<div class="line">            archive &gt;&gt; d.entries()[i].originalSize();</div>
<div class="line">            archive &gt;&gt; d.entries()[i].compressedSize();     </div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">// this is now the relevent data for the currently loaded archive.</span></div>
<div class="line">        <a class="code" href="class_archiver.html#ad10ce9510f82df224ce604e470cf2ca4">descriptor</a>() = d;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">throw</span> <a class="code" href="class_archiver_exception.html">ArchiverException</a>( <span class="stringliteral">&quot;An error occured trying to load the archive.&quot;</span> );</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a444f4f2179d485251924fdae593a88b9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Archiver::New </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>archivePath</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Instantiates a new <a class="el" href="class_archive_descriptor.html">ArchiveDescriptor</a> configured with the specified destination path and updates the descriptor reference held by this class </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">archivePath</td><td>the fully qualified path name of the new archive </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="_archiver_8cpp_source.html#l00013">13</a> of file <a class="el" href="_archiver_8cpp_source.html">Archiver.cpp</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <a class="code" href="class_archiver.html#ad10ce9510f82df224ce604e470cf2ca4">descriptor</a>() = <a class="code" href="class_archive_descriptor.html">ArchiveDescriptor</a>( archivePath );</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a5d78f57a4e1035fd5bb380eee8cfc8bf"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void Archiver::PositionStreamAtFooter </td>
          <td>(</td>
          <td class="paramtype">std::istream &amp;&#160;</td>
          <td class="paramname"><em>archiveStream</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Finds the footer index and positions the supplied stream (hopefully connected to an archive file created by this program) at that index, in preparation for loading. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">archiveStream</td><td>an open stream to an existing archive file on disk </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="_archiver_8cpp_source.html#l00171">171</a> of file <a class="el" href="_archiver_8cpp_source.html">Archiver.cpp</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <span class="comment">// the last line of the archive contains the footer position.</span></div>
<div class="line">    <span class="comment">// seek to the end of file content, then read backwards</span></div>
<div class="line">    <span class="comment">// a character at a time until a newline is reached.</span></div>
<div class="line">    <span class="comment">// the characters encountered along the way form the string</span></div>
<div class="line">    <span class="comment">// version of the footer position.</span></div>
<div class="line"></div>
<div class="line">    archiveStream.seekg( 0, std::ios::end);</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> length = archiveStream.tellg();</div>
<div class="line"></div>
<div class="line">    std::string s;</div>
<div class="line">    <span class="keywordtype">char</span> c = 0;</div>
<div class="line">    <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = length - 1; i != 0 &amp;&amp; c != <span class="charliteral">&#39;\n&#39;</span>; i-- )</div>
<div class="line">    {</div>
<div class="line">        archiveStream.seekg( i, std::ios::beg );</div>
<div class="line">        archiveStream.get( c );</div>
<div class="line">        <span class="keywordflow">if</span> ( c != <span class="charliteral">&#39;\n&#39;</span> )</div>
<div class="line">        {</div>
<div class="line">            s.insert( 0, 1, c );</div>
<div class="line">        }</div>
<div class="line">    }     </div>
<div class="line"></div>
<div class="line">    <span class="comment">// convert the string version of the footer position to</span></div>
<div class="line">    <span class="comment">// a numerical quantity, then position the stream</span></div>
<div class="line">    std::istringstream iss( s );</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> footerPosition = 0;</div>
<div class="line">    iss &gt;&gt; footerPosition;</div>
<div class="line">    archiveStream.seekg( footerPosition, std::ios::beg );</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ab1593f11dac0f5e4f7092de25a9005ae"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Archiver::Save </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Compresses and saves a new archive containing the files in the currently loaded <a class="el" href="class_archive_descriptor.html">ArchiveDescriptor</a></p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000001">Todo:</a></b></dt><dd><p class="startdd">Add callback parameter to decouple progress dialog </p>
<p>Put a timestamp in the file footer to ensure the file hasn't been modified since it was loaded </p>
<p>Add a file format GUID to the output file so we can detect files we didn't make and abort processing them asap </p>
<p class="enddd">Ensure any changes made here are handled in <a class="el" href="class_archiver.html#a06897312c155d91a5130f49cd00be491">Extract()</a> </p>
</dd></dl>

<p>Definition at line <a class="el" href="_archiver_8cpp_source.html#l00036">36</a> of file <a class="el" href="_archiver_8cpp_source.html">Archiver.cpp</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    std::ofstream archiveFile( <a class="code" href="class_archiver.html#ad10ce9510f82df224ce604e470cf2ca4">descriptor</a>().filePath(), std::ios::binary|std::ios::out|std::ios::trunc );</div>
<div class="line">    <span class="keywordflow">if</span>( archiveFile.fail() )</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">throw</span> <a class="code" href="class_archiver_exception.html">ArchiverException</a>( <span class="stringliteral">&quot;Failed to create output stream. Unable to write archive to disk.&quot;</span> );</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <a class="code" href="class_button.html">Button</a> b;</div>
<div class="line">    <a class="code" href="class_button_output_stream.html">ButtonOutputStream</a> bstream( archiveFile );</div>
<div class="line">    <a class="code" href="class_archive_entry.html#a90c10b0aa1c75f3abd539d2e089c18e6">ArchiveEntry::Vector</a> entries = <a class="code" href="class_archiver.html#ad10ce9510f82df224ce604e470cf2ca4">descriptor</a>().<a class="code" href="class_archive_descriptor.html#a5bb6959e9022cf36b08b54cf31e6d4ed">entries</a>();</div>
<div class="line">    std::ifstream file;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// progress dialog... </span></div>
<div class="line">    <span class="keywordtype">int</span> fileProcessingIndex = 0;</div>
<div class="line">    wxProgressDialog progressDialog( <span class="stringliteral">&quot;Buttoning Up&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, entries.size(), wxGetApp().GetTopWindow(), </div>
<div class="line">                wxPD_APP_MODAL | wxPD_SMOOTH | wxPD_AUTO_HIDE );</div>
<div class="line">    <span class="keywordflow">for</span>(ArchiveEntry::Vector::iterator it = entries.begin(); it!=entries.end(); it++)</div>
<div class="line">    {   </div>
<div class="line">        <span class="comment">// this part is just the progress dialog</span></div>
<div class="line">        std::ostringstream message( std::ios::out );</div>
<div class="line">        message &lt;&lt; <span class="stringliteral">&quot;Buttoning file &quot;</span> &lt;&lt; fileProcessingIndex &lt;&lt; <span class="stringliteral">&quot; of &quot;</span> &lt;&lt; entries.size() &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; it-&gt;fileName();</div>
<div class="line">        progressDialog.Update( ++fileProcessingIndex, message.str() );</div>
<div class="line"></div>
<div class="line">        <span class="comment">// compress the file and update the archive descriptor with some stats</span></div>
<div class="line">        it-&gt;originalSize() = <a class="code" href="class_archiver.html#aa1b1f55fb19f6be1ed2deacbe6badaf7">FileSize</a>( it-&gt;filePath() );            </div>
<div class="line">        file.open(it-&gt;filePath(), std::ios::binary|std::ios::in); </div>
<div class="line">        it-&gt;compressedSize() = b.<a class="code" href="class_button.html#aa2cd27a68af14c5ff8fe83a91e865b71">compress</a>( file, bstream );</div>
<div class="line">        file.close();</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// because of the variable length encodings, the last </span></div>
<div class="line">    <span class="comment">// END_OF_FILE code can get truncated on the final </span></div>
<div class="line">    <span class="comment">// write, leading to... Disaster!</span></div>
<div class="line">    <span class="comment">// Writing this wee string to the stream forces all of</span></div>
<div class="line">    <span class="comment">// the END_OF_FILE code out into the stream, enabling the </span></div>
<div class="line">    <span class="comment">// extraction process to correctly see the last END_OF_FILE </span></div>
<div class="line">    <span class="comment">// code. (a little bit kludgy but fine for now)</span></div>
<div class="line">    b.<a class="code" href="class_button.html#aa2cd27a68af14c5ff8fe83a91e865b71">compress</a>( std::istringstream(<span class="stringliteral">&quot;b&quot;</span>, std::ios::in ), bstream );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Create footer containing archive statistics. </span></div>
<div class="line">    </div>
<div class="line">    <span class="comment">// first note the stream position. this is the start of the footer</span></div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> footerPosition = archiveFile.tellp();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// number of files in archive</span></div>
<div class="line">    archiveFile &lt;&lt; entries.size() &lt;&lt; std::endl;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// individual file information </span></div>
<div class="line">    <span class="keywordflow">for</span> ( ArchiveEntry::Vector::iterator it=entries.begin(); it != entries.end(); it++ )</div>
<div class="line">    {</div>
<div class="line">        archiveFile &lt;&lt; it-&gt;filePath() &lt;&lt; std::endl;</div>
<div class="line">        archiveFile &lt;&lt; it-&gt;fileName() &lt;&lt; std::endl;</div>
<div class="line">        archiveFile &lt;&lt; it-&gt;originalSize() &lt;&lt; std::endl;</div>
<div class="line">        archiveFile &lt;&lt; it-&gt;compressedSize() &lt;&lt; std::endl;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// lastly, a newline followed by the index of</span></div>
<div class="line">    <span class="comment">// where the footer begins. (the footer is used to view</span></div>
<div class="line">    <span class="comment">// the content of the archive without having to decompress</span></div>
<div class="line">    <span class="comment">// the whole thing.) The load function will jump to the </span></div>
<div class="line">    <span class="comment">// end of the file, find this index, and use the footer</span></div>
<div class="line">    <span class="comment">// info to build the ArchiveDescriptor</span></div>
<div class="line">    archiveFile &lt;&lt; std::endl &lt;&lt; footerPosition;</div>
<div class="line">    archiveFile.close();</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a class="anchor" id="af2fb4aea2e55ed35f61f2ef01b2a8076"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_archive_descriptor.html">ArchiveDescriptor</a> Archiver::m_descriptor</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>When an archive is loaded (either from loading an existing one, or creating a new one) information about its content is held here </p>

<p>Definition at line <a class="el" href="_archiver_8h_source.html#l00089">89</a> of file <a class="el" href="_archiver_8h_source.html">Archiver.h</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="_archiver_8h_source.html">Archiver.h</a></li>
<li><a class="el" href="_archiver_8cpp_source.html">Archiver.cpp</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="class_archiver.html">Archiver</a></li>
    <li class="footer">Generated on Sun Dec 2 2012 00:27:15 by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.2 </li>
  </ul>
</div>
</body>
</html>
